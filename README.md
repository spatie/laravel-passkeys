**THIS PACKAGE IS IN DEVELOPMENT, DO NOT USE (YET)**

# Use passkeys in your Laravel app

[![Latest Version on Packagist](https://img.shields.io/packagist/v/spatie/laravel-passkeys.svg?style=flat-square)](https://packagist.org/packages/spatie/laravel-passkeys)
[![GitHub Tests Action Status](https://img.shields.io/github/actions/workflow/status/spatie/laravel-passkeys/run-tests.yml?branch=main&label=tests&style=flat-square)](https://github.com/spatie/laravel-passkeys/actions?query=workflow%3Arun-tests+branch%3Amain)
[![GitHub Code Style Action Status](https://img.shields.io/github/actions/workflow/status/spatie/laravel-passkeys/fix-php-code-style-issues.yml?branch=main&label=code%20style&style=flat-square)](https://github.com/spatie/laravel-passkeys/actions?query=workflow%3A"Fix+PHP+code+style+issues"+branch%3Amain)
[![Total Downloads](https://img.shields.io/packagist/dt/spatie/laravel-passkeys.svg?style=flat-square)](https://packagist.org/packages/spatie/laravel-passkeys)

Passkeys let you log in without needing a password. The process can be compared to how SSH keys work.

A passkey is a unique key pair that is generated by a password manager or hardware security key. One key is public and stored on in your Laravel app, and the other is private and stored in the password manager.

When logging using a passkey, the Laravel app will generate a challenge that your password manager can solve using the stored private key. The password manager will create a secure response and sends it back to Laravel app. If the challenge is solved correctly, you're logged in.

You can learn more about how passkeys work [here](https://www.dashlane.com/blog/what-is-a-passkey-and-how-does-it-work#).

This package provides a simple way to generate passkey using a Livewire component. It also contains a Blade component that can authenticate using passkeys.

## Support us

[<img src="https://github-ads.s3.eu-central-1.amazonaws.com/laravel-passkeys.jpg?t=1" width="419px" />](https://spatie.be/github-ad-click/laravel-passkeys)

We invest a lot of resources into creating [best in class open source packages](https://spatie.be/open-source). You can support us by [buying one of our paid products](https://spatie.be/open-source/support-us).

We highly appreciate you sending us a postcard from your hometown, mentioning which of our package(s) you are using. You'll find our address on [our contact page](https://spatie.be/about-us). We publish all received postcards on [our virtual postcard wall](https://spatie.be/open-source/postcards).

## Requirements

This package contains a Livewire component to generate passkeys. Make sure you have Livewire installed in your Laravel app.

## Installation

### 1. Install the package via composer

```bash
composer require spatie/laravel-passkeys
```

### 2. Add the package's interface and trait to your Authenticatable model

```php
// app/Models/User.php
namespace App\Models;

use Spatie\LaravelPasskeys\Models\Concerns\HasPasskeys;
use Spatie\LaravelPasskeys\Models\Concerns\InteractsWithPasskeys;
// ...

class User extends Authenticatable implements HasPasskeys
{
    use HasFactory, Notifiable, InteractsWithPasskeys;

    // ... 
}
```

### 3. Publish and run the migrations

```bash
php artisan vendor:publish --tag="passkeys-migrations"
php artisan migrate
```

### 4. Install the JavaScript dependencies

```bash
npm install @simplewebauthn/browser
```

### 5. Import the JavaScript dependencies

```javascript
// resources/js/bootstrap.js
import {
    browserSupportsWebAuthn,
    startAuthentication,
    startRegistration,
} from '@simplewebauthn/browser'

window.browserSupportsWebAuthn = browserSupportsWebAuthn
window.startAuthentication = startAuthentication
window.startRegistration = startRegistration
```

### 6. Re-build the JavaScript assets

```bash
npm run build
```

### 7. Add the package provided routes

```php
// routes/web.php
Route::passkeys();
```

### 8. Add the authentication component to the login view

```html
<!--Laravel Breeze: resources/views/livewire/pages/auth/login.blade.php-->
<x-authenticate-passkey />
```

### 9. Add the passkey management component to the profile view

```html
<!--Laravel Breeze: resources/views/profile.blade.php-->
<livewire:passkeys />
```

### 10. (Optional) Publish the views for custom styling

```bash
php artisan vendor:publish --tag="passkeys-views"
```

### 11. (Optional) Set the `AUTH_MODEL` in your `.env` file
Set the `AUTH_MODEL` in your `.env` file to the class name of the model that should be authenticated using passkeys.
```bash
AUTH_MODEL=App\Models\User
```

### 12. (Optional) Publish the config file

```bash
php artisan vendor:publish --tag="passkeys-config"
```

This is the contents of the published config file:

```php
return [
    /*
     * After a successful authentication attempt using a passkey
     * we'll redirect to this URL.
     */
    'redirect_to_after_login' => '/dashboard',

    /*
     * These class are responsible for performing core tasks regarding passkeys.
     * You can customize them by creating a class that extends the default, and
     * by specify your custom class name here
     */
    'actions' => [
        'generate_passkey_register_options' => Spatie\LaravelPasskeys\Actions\GeneratePasskeyRegisterOptionsAction::class,
        'store_passkey' => Spatie\LaravelPasskeys\Actions\StorePasskeyAction::class,
        'generate_passkey_authentication_options' => \Spatie\LaravelPasskeys\Actions\GeneratePasskeyAuthenticationOptionsAction::class,
        'find_passkey' => \Spatie\LaravelPasskeys\Actions\FindPasskeyToAuthenticateAction::class,
    ],

    /*
     * These properties will be used to generate the passkey.
     */
    'relying_party' => [
        'name' => config('app.name'),
        'id' => parse_url(config('app.url'), PHP_URL_HOST),
        'icon' => null,
    ],

    /*
     * The models used by the package. 
     * You can override this by specifying your own models
     */
    'models' => [
        'passkey' => Spatie\LaravelPasskeys\Models\Passkey::class,
        'authenticatable' => env('AUTH_MODEL', App\Models\User::class),
    ],
];
```

## Usage

There are two parts to using passkeys in your Laravel app: creating a passkey and authenticating using a passkey.

### Creating a passkey

The package provides a Livewire component to generate a passkey. It is able to create a passkey for the currently logged in user. It will also show all generated passkeys.

You can include this component in your views.

```html
<livewire:passkeys />
```

Here's how the component looks like:

// TODO: insert image

### Authenticating using a passkey

To let your users authenticate using a passkey, you can include the `authenticate-passkey` Blade component in your view, typically on your login view.

```html 
<x-authenticate-passkey />
```

// TODO: insert image

This component will show a link that, when clicked, will start the passkey authentication process. 

If the authentication is successful, the user will be redirected to the URL specified in the  `redirect_to_after_login` key of the `passkeys` config file.

#### Customizing the look and feel of the component

To customize the look and feel of the component, you can pass HTML to the component.

```html
<x-authenticate-passkey>
    <button class="bg-blue-500 text-white px-4 py-2 rounded">Authenticate using passkey</button>
</x-authenticate-passkey>
```

To customize where the user is redirected after a successful login, you can pass a URL to the `redirect` prop of component.

```html
<x-authenticate-passkey redirect="/dashboard" />
```    

### Events

The package fires the `Spatie\LaravelPasskeys\Events\PasskeyUsedToAuthenticateEvent` when a passkey is used to authenticate. It has a property `passkey` that contains the `Passkey` model that was used to authenticate.

## Testing

```bash
composer test
```

## Changelog

Please see [CHANGELOG](CHANGELOG.md) for more information on what has changed recently.

## Contributing

Please see [CONTRIBUTING](CONTRIBUTING.md) for details.

## Security Vulnerabilities

Please review [our security policy](../../security/policy) on how to report security vulnerabilities.

## Credits

This code is based on the [Laracast course on passkeys](https://laracasts.com/series/add-passkeys-to-a-laravel-app) by the amazing [Luke Downing](https://github.com/lukeraymonddowning).

- [Freek Van der Herten](https://github.com/freekmurze)
- [All Contributors](../../contributors)

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.
